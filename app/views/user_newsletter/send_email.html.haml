%article
  - for article in @articles
    .tags
      - for tag in article.tags
        .tag=tag
    .content
      %h2= link_to article.title, article_path(article)
      %i= article.subhead
      - if article.events.present?
        %small.info
          - if article.events.first.start_date > Time.current
            %strong= custom_time_distance(article.events.first.start_date) + "!"
          - else
            = time_ago_in_words(article.events.first.start_date)
            ago
          = article.events.first.start_date.strftime("%A, %b %d")
          @
          = article.events.first.start_date.strftime("%l:%M%P")
          - if article.locations.present?
            at
            = article.locations.first.line_1 + ","
            = article.locations.first.city
            = link_to "map", "http://maps.apple.com/maps?q=#{article.locations.first.latitude},#{article.locations.first.longitude}", :class => "tag-button"
      %small.info
        - if article.publish_date.present?
          = time_ago_in_words(article.publish_date)
          ago •
        - if article.recommended_users.present?
          recommended by
          = article.recommended_users.count
          - if article.recommended_users.count > 1
            people •
          - else
            person
    - if @articles.first
      = image_tag article.image.hero
      %p= Nokogiri::HTML.parse(markdown(article.body)).css('p').first.text
      = link_to 'read',  article, class: "tag pull-right"
    - else
      .pull-right= link_to image_tag(article.image.small), article
    - unless @articles.last
      %hr